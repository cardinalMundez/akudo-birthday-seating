<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Akudo's 70th ‚Äî JSON Database with CRUD</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Montserrat:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  /* (styles identical to previous version, plus some additions for JSON viewer) */
  :root {
    --gold: #c9a84c;
    --gold-light: #e8c97a;
    --gold-pale: #f5e9c8;
    --dark: #0d0a06;
    --dark2: #1a1408;
    --dark3: #241d0d;
    --text: #f0e6c8;
    --text-muted: #a08a5a;
    --table-bg: #1e1608;
    --table-border: #c9a84c;
    --modal-bg: #120f08;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--dark);
    color: var(--text);
    font-family: 'Montserrat', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: 
      radial-gradient(ellipse 80% 60% at 50% -10%, rgba(201,168,76,0.12) 0%, transparent 60%),
      radial-gradient(ellipse 40% 40% at 20% 80%, rgba(201,168,76,0.06) 0%, transparent 50%),
      radial-gradient(ellipse 40% 40% at 80% 90%, rgba(201,168,76,0.06) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }

  .grain {
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 1;
    opacity: 0.4;
  }

  main { position: relative; z-index: 2; }

  header {
    text-align: center;
    padding: 60px 20px 40px;
    position: relative;
  }

  .header-ornament {
    font-size: 1.2rem;
    color: var(--gold);
    letter-spacing: 0.5em;
    margin-bottom: 16px;
    animation: fadeUp 1s ease both;
  }

  h1 {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(2.2rem, 6vw, 4.5rem);
    font-weight: 300;
    color: var(--gold-light);
    line-height: 1.1;
    animation: fadeUp 1s ease 0.2s both;
  }

  h1 em {
    font-style: italic;
    font-weight: 300;
  }

  .subtitle {
    font-size: 0.75rem;
    letter-spacing: 0.35em;
    color: var(--text-muted);
    margin-top: 12px;
    text-transform: uppercase;
    animation: fadeUp 1s ease 0.4s both;
  }

  .divider {
    display: flex;
    align-items: center;
    gap: 16px;
    margin: 32px auto;
    max-width: 500px;
    animation: fadeUp 1s ease 0.5s both;
  }
  .divider-line {
    flex: 1;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
  }
  .divider-diamond {
    width: 8px;
    height: 8px;
    background: var(--gold);
    transform: rotate(45deg);
    flex-shrink: 0;
  }

  .birthday-msg {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(1.1rem, 3vw, 1.7rem);
    font-style: italic;
    color: var(--gold-pale);
    max-width: 650px;
    margin: 0 auto 8px;
    animation: fadeUp 1s ease 0.6s both;
  }

  .birthday-msg span {
    color: var(--gold);
  }

  .search-wrap {
    max-width: 500px;
    margin: 30px auto 10px;
    animation: fadeUp 1s ease 0.7s both;
    padding: 0 20px;
  }

  .search-box {
    width: 100%;
    background: rgba(201,168,76,0.06);
    border: 1px solid rgba(201,168,76,0.3);
    color: var(--text);
    padding: 12px 20px;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.8rem;
    letter-spacing: 0.1em;
    outline: none;
    transition: border-color 0.3s, background 0.3s;
  }
  .search-box::placeholder { color: var(--text-muted); }
  .search-box:focus {
    border-color: var(--gold);
    background: rgba(201,168,76,0.1);
  }

  .search-result {
    background: var(--dark3);
    border: 1px solid var(--gold);
    padding: 14px 20px;
    margin-top: 8px;
    font-size: 0.8rem;
    display: none;
    animation: fadeUp 0.3s ease;
  }

  .search-result.show { display: block; }
  .search-result .found-name { color: var(--gold-light); font-weight: 500; }
  .search-result .found-table { color: var(--text-muted); }

  .floor-section {
    padding: 20px 20px 60px;
    animation: fadeUp 1s ease 0.8s both;
  }

  .floor-label {
    text-align: center;
    font-size: 0.65rem;
    letter-spacing: 0.4em;
    color: var(--text-muted);
    text-transform: uppercase;
    margin-bottom: 30px;
  }

  .stage {
    max-width: 900px;
    margin: 0 auto 30px;
    text-align: center;
  }

  .stage-bar {
    display: inline-block;
    padding: 10px 60px;
    border: 1px solid rgba(201,168,76,0.4);
    background: linear-gradient(135deg, rgba(201,168,76,0.1), rgba(201,168,76,0.05));
    font-size: 0.65rem;
    letter-spacing: 0.4em;
    color: var(--gold);
    text-transform: uppercase;
  }

  .floor-grid {
    max-width: 1000px;
    margin: 0 auto;
    display: grid;
    grid-template-rows: repeat(6, auto);
    gap: 20px;
  }

  .table-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
  }

  .table-row.last-row {
    grid-template-columns: 1fr 1fr 1fr 1fr;
  }

  .table-spacer { visibility: hidden; }

  .table-card {
    position: relative;
    cursor: pointer;
    padding: 18px 14px;
    text-align: center;
    background: var(--table-bg);
    border: 1px solid rgba(201,168,76,0.2);
    transition: all 0.35s cubic-bezier(0.16,1,0.3,1);
    overflow: hidden;
  }

  .table-card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 50% 0%, rgba(201,168,76,0.12) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.35s;
  }

  .table-card:hover {
    border-color: var(--gold);
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(201,168,76,0.2), 0 0 0 1px rgba(201,168,76,0.3);
  }

  .table-card:hover::before { opacity: 1; }

  .table-card.highlight {
    border-color: var(--gold);
    background: rgba(201,168,76,0.15);
    animation: pulse 1.5s ease infinite;
  }

  @keyframes pulse {
    0%,100% { box-shadow: 0 0 0 0 rgba(201,168,76,0.4); }
    50% { box-shadow: 0 0 0 8px rgba(201,168,76,0); }
  }

  .table-num {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2rem;
    font-weight: 300;
    color: var(--gold);
    line-height: 1;
    display: block;
  }

  .table-tag {
    font-size: 0.55rem;
    letter-spacing: 0.25em;
    color: var(--text-muted);
    text-transform: uppercase;
    margin: 4px 0 8px;
    display: block;
  }

  .table-count {
    font-size: 0.65rem;
    color: var(--gold-pale);
    opacity: 0.7;
  }

  .table-category {
    font-size: 0.55rem;
    letter-spacing: 0.15em;
    color: var(--gold);
    text-transform: uppercase;
    margin-top: 6px;
    opacity: 0.7;
    display: block;
  }

  .table-card.vvip {
    border-color: rgba(201,168,76,0.5);
    background: linear-gradient(135deg, #1e1608, #2a1e08);
  }
  .table-card.vvip .table-num { color: var(--gold-light); font-size: 2.4rem; }

  .overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(6px);
    z-index: 100;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }
  .overlay.open { opacity: 1; pointer-events: all; }

  .modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -48%) scale(0.96);
    width: min(560px, 95vw);
    max-height: 85vh;
    background: var(--modal-bg);
    border: 1px solid rgba(201,168,76,0.4);
    z-index: 101;
    opacity: 0;
    pointer-events: none;
    transition: all 0.35s cubic-bezier(0.16,1,0.3,1);
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  .modal.open {
    opacity: 1;
    pointer-events: all;
    transform: translate(-50%, -50%) scale(1);
  }

  .modal-header {
    padding: 28px 28px 20px;
    border-bottom: 1px solid rgba(201,168,76,0.2);
    flex-shrink: 0;
    position: relative;
  }

  .modal-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.8rem;
    font-weight: 300;
    color: var(--gold-light);
  }

  .modal-subtitle {
    font-size: 0.65rem;
    letter-spacing: 0.3em;
    color: var(--text-muted);
    margin-top: 4px;
  }

  .modal-close {
    position: absolute;
    top: 20px;
    right: 20px;
    background: none;
    border: 1px solid rgba(201,168,76,0.3);
    color: var(--gold);
    width: 32px;
    height: 32px;
    cursor: pointer;
    font-size: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  .modal-close:hover { background: rgba(201,168,76,0.15); border-color: var(--gold); }

  .modal-body {
    overflow-y: auto;
    flex: 1;
    padding: 20px 28px 28px;
  }

  .modal-body::-webkit-scrollbar { width: 4px; }
  .modal-body::-webkit-scrollbar-track { background: transparent; }
  .modal-body::-webkit-scrollbar-thumb { background: rgba(201,168,76,0.3); }

  .guest-item {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 10px 0;
    border-bottom: 1px solid rgba(201,168,76,0.08);
    transition: background 0.2s;
  }
  .guest-item:last-child { border-bottom: none; }

  .guest-num {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1rem;
    color: var(--gold);
    width: 22px;
    flex-shrink: 0;
    text-align: right;
  }

  .guest-name {
    font-size: 0.8rem;
    color: var(--text);
    flex: 1;
    letter-spacing: 0.03em;
  }

  /* NEW: JSON Database Controls */
  .db-controls {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 20px auto;
    max-width: 600px;
    padding: 0 20px;
    flex-wrap: wrap;
  }

  .db-btn {
    background: var(--dark3);
    border: 1px solid rgba(201,168,76,0.3);
    color: var(--gold);
    padding: 12px 24px;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.7rem;
    letter-spacing: 0.2em;
    cursor: pointer;
    text-transform: uppercase;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  .db-btn:hover { border-color: var(--gold); background: rgba(201,168,76,0.1); }
  .db-btn.danger:hover { border-color: #e06060; color: #e06060; }

  .json-viewer {
    max-width: 1000px;
    margin: 30px auto;
    background: var(--dark3);
    border: 1px solid rgba(201,168,76,0.2);
    padding: 20px;
    display: none;
  }
  .json-viewer.open { display: block; }

  .json-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }
  .json-header h3 {
    font-family: 'Cormorant Garamond', serif;
    color: var(--gold-light);
    font-weight: 300;
  }
  .json-content {
    background: var(--dark);
    padding: 20px;
    border: 1px solid rgba(201,168,76,0.15);
    font-family: monospace;
    font-size: 0.8rem;
    color: var(--gold-pale);
    white-space: pre-wrap;
    max-height: 400px;
    overflow-y: auto;
  }

  .admin-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: var(--dark3);
    border: 1px solid rgba(201,168,76,0.3);
    color: var(--gold);
    padding: 10px 18px;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    cursor: pointer;
    text-transform: uppercase;
    transition: all 0.2s;
    z-index: 50;
  }
  .admin-btn:hover { border-color: var(--gold); background: rgba(201,168,76,0.1); }

  .print-word-btn {
    position: fixed;
    bottom: 30px;
    right: 160px;
    background: var(--dark3);
    border: 1px solid rgba(201,168,76,0.3);
    color: var(--gold);
    padding: 10px 18px;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    cursor: pointer;
    text-transform: uppercase;
    transition: all 0.2s;
    z-index: 50;
  }
  .print-word-btn:hover { border-color: var(--gold); background: rgba(201,168,76,0.1); }

  .admin-panel {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.92);
    backdrop-filter: blur(10px);
    z-index: 200;
    display: none;
    overflow-y: auto;
  }
  .admin-panel.open { display: block; }

  .admin-inner {
    max-width: 800px;
    margin: 0 auto;
    padding: 40px 20px 80px;
  }

  .admin-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 40px;
    padding-bottom: 20px;
    border-bottom: 1px solid rgba(201,168,76,0.3);
  }

  .admin-header h2 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2rem;
    font-weight: 300;
    color: var(--gold-light);
  }

  .admin-close {
    background: none;
    border: 1px solid rgba(201,168,76,0.3);
    color: var(--gold);
    padding: 8px 16px;
    cursor: pointer;
    font-size: 0.7rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    font-family: 'Montserrat', sans-serif;
    transition: all 0.2s;
  }
  .admin-close:hover { background: rgba(201,168,76,0.1); border-color: var(--gold); }

  .admin-login {
    text-align: center;
    padding: 60px 20px;
  }
  .admin-login p {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.4rem;
    color: var(--text-muted);
    margin-bottom: 24px;
    font-style: italic;
  }
  .admin-input {
    background: rgba(201,168,76,0.06);
    border: 1px solid rgba(201,168,76,0.3);
    color: var(--text);
    padding: 12px 20px;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.8rem;
    outline: none;
    width: 280px;
    letter-spacing: 0.15em;
    transition: border-color 0.3s;
  }
  .admin-input:focus { border-color: var(--gold); }
  .admin-submit {
    display: block;
    margin: 16px auto 0;
    background: linear-gradient(135deg, rgba(201,168,76,0.2), rgba(201,168,76,0.1));
    border: 1px solid var(--gold);
    color: var(--gold);
    padding: 12px 36px;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.7rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }
  .admin-submit:hover { background: rgba(201,168,76,0.25); }

  .admin-error {
    color: #e06060;
    font-size: 0.75rem;
    text-align: center;
    margin-top: 10px;
    display: none;
  }

  .admin-tables { display: none; }
  .admin-tables.show { display: block; }

  .admin-table-card {
    background: var(--dark3);
    border: 1px solid rgba(201,168,76,0.15);
    margin-bottom: 16px;
    overflow: hidden;
  }

  .admin-table-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 20px;
    cursor: pointer;
    transition: background 0.2s;
  }
  .admin-table-header:hover { background: rgba(201,168,76,0.06); }

  .admin-table-header h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.2rem;
    color: var(--gold-light);
    font-weight: 300;
  }

  .admin-table-toggle {
    color: var(--gold);
    font-size: 0.8rem;
    transition: transform 0.2s;
  }
  .admin-table-toggle.open { transform: rotate(180deg); }

  .admin-table-body {
    padding: 0 20px;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease, padding 0.3s;
  }
  .admin-table-body.open {
    max-height: 1000px;
    padding: 10px 20px 20px;
  }

  .admin-guest-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
  }

  .admin-guest-num {
    color: var(--gold);
    font-size: 0.75rem;
    width: 20px;
    flex-shrink: 0;
    font-family: 'Cormorant Garamond', serif;
  }

  .admin-guest-input {
    flex: 1;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(201,168,76,0.15);
    color: var(--text);
    padding: 7px 12px;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.75rem;
    outline: none;
    transition: border-color 0.2s;
  }
  .admin-guest-input:focus { border-color: var(--gold); }

  .admin-delete-btn {
    background: none;
    border: 1px solid rgba(200,80,80,0.3);
    color: rgba(200,80,80,0.7);
    width: 26px;
    height: 26px;
    cursor: pointer;
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all 0.2s;
  }
  .admin-delete-btn:hover { background: rgba(200,80,80,0.15); border-color: rgba(200,80,80,0.7); }

  .admin-add-btn {
    background: none;
    border: 1px dashed rgba(201,168,76,0.3);
    color: var(--text-muted);
    padding: 7px 16px;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    cursor: pointer;
    width: 100%;
    margin-top: 6px;
    transition: all 0.2s;
    text-transform: uppercase;
  }
  .admin-add-btn:hover { border-color: var(--gold); color: var(--gold); }

  .admin-save-btn {
    background: linear-gradient(135deg, rgba(201,168,76,0.25), rgba(201,168,76,0.1));
    border: 1px solid var(--gold);
    color: var(--gold);
    padding: 14px 40px;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    cursor: pointer;
    display: block;
    margin: 30px auto 0;
    transition: all 0.2s;
  }
  .admin-save-btn:hover { background: rgba(201,168,76,0.3); }

  .save-toast {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: var(--dark3);
    border: 1px solid var(--gold);
    color: var(--gold-light);
    padding: 12px 28px;
    font-size: 0.75rem;
    letter-spacing: 0.15em;
    opacity: 0;
    transition: all 0.4s;
    z-index: 300;
    pointer-events: none;
  }
  .save-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  .stats-bar {
    display: flex;
    justify-content: center;
    gap: 40px;
    padding: 16px 20px;
    margin: 0 auto 10px;
    max-width: 600px;
    animation: fadeUp 1s ease 0.9s both;
  }

  .stat {
    text-align: center;
  }
  .stat-num {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2rem;
    color: var(--gold);
    display: block;
    line-height: 1;
  }
  .stat-label {
    font-size: 0.55rem;
    letter-spacing: 0.3em;
    color: var(--text-muted);
    text-transform: uppercase;
    margin-top: 2px;
    display: block;
  }

  #confetti { position: fixed; inset: 0; pointer-events: none; z-index: 0; }

  @media (max-width: 700px) {
    .table-row { grid-template-columns: repeat(2, 1fr); gap: 12px; }
    .table-row.last-row { grid-template-columns: 1fr 1fr 1fr 1fr; }
    .stats-bar { gap: 20px; }
    .print-word-btn { right: 30px; bottom: 80px; }
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>

<canvas id="confetti"></canvas>
<div class="grain"></div>

<main>
  <header>
    <div class="header-ornament">‚ú¶ &nbsp; CELEBRATING &nbsp; ‚ú¶</div>
    <h1>Akudo's <em>70<sup style="font-size:0.5em;vertical-align:super">th</sup></em><br>Birthday</h1>
    <p class="subtitle">Seating Arrangement & Floor Plan</p>
    <div class="divider">
      <div class="divider-line"></div>
      <div class="divider-diamond"></div>
      <div class="divider-diamond" style="width:5px;height:5px;opacity:0.5;margin:0 2px"></div>
      <div class="divider-diamond"></div>
      <div class="divider-line"></div>
    </div>
    <p class="birthday-msg">"Seven decades of grace, wisdom, and love ‚Äî<br>Here's to you, <span> Akudo</span>. Happy 70th Birthday! ü•Ç"</p>
  </header>

  <!-- NEW: JSON Database Controls -->
  <div class="db-controls">
    <button class="db-btn" onclick="toggleJsonViewer()">üìã View JSON Database</button>
    <button class="db-btn" onclick="exportJson()">üíæ Export JSON</button>
    <button class="db-btn" onclick="importJson()">üìÇ Import JSON</button>
    <button class="db-btn danger" onclick="resetToDefault()">‚Ü∫ Reset to Default</button>
  </div>

  <!-- NEW: JSON Viewer Panel -->
  <div class="json-viewer" id="jsonViewer">
    <div class="json-header">
      <h3>Current JSON Database</h3>
      <button class="db-btn" onclick="copyJson()">üìã Copy</button>
    </div>
    <div class="json-content" id="jsonContent"></div>
    <input type="file" id="jsonImportFile" accept=".json" style="display: none" onchange="handleJsonImport()">
  </div>

  <div class="stats-bar" id="statsBar">
    <div class="stat"><span class="stat-num" id="statTables">22</span><span class="stat-label">Tables</span></div>
    <div class="stat"><span class="stat-num" id="statGuests">0</span><span class="stat-label">Guests</span></div>
    <div class="stat"><span class="stat-num">1</span><span class="stat-label">Celebration</span></div>
  </div>

  <div class="search-wrap">
    <input type="text" class="search-box" id="searchBox" placeholder="üîç  Search for a guest by name..." oninput="searchGuest(this.value)">
    <div class="search-result" id="searchResult"></div>
  </div>

  <div class="floor-section">
    <div class="floor-label">‚Üë Stage / High Table &nbsp;&nbsp;‚Äî&nbsp;&nbsp; Click any table to view guests ‚Üì</div>

    <div class="stage"><div class="stage-bar">‚ú¶ &nbsp; High Table / Stage &nbsp; ‚ú¶</div></div>

    <div class="floor-grid" id="floorGrid"></div>
  </div>
</main>

<!-- VIEW MODAL -->
<div class="overlay" id="overlay" onclick="closeModal()"></div>
<div class="modal" id="modal">
  <div class="modal-header">
    <div class="modal-title" id="modalTitle">Table 1</div>
    <div class="modal-subtitle" id="modalSubtitle">SEATED GUESTS</div>
    <button class="modal-close" onclick="closeModal()">‚úï</button>
  </div>
  <div class="modal-body" id="modalBody"></div>
</div>

<!-- ADMIN PANEL -->
<div class="admin-panel" id="adminPanel">
  <div class="admin-inner">
    <div class="admin-header">
      <h2>Admin Panel</h2>
      <button class="admin-close" onclick="closeAdmin()">‚úï Close</button>
    </div>

    <div id="adminLogin" class="admin-login">
      <p>Enter administrator password to manage the guest list</p>
      <input type="password" class="admin-input" id="adminPwd" placeholder="Password" onkeydown="if(event.key==='Enter')doLogin()">
      <button class="admin-submit" onclick="doLogin()">Enter</button>
      <div class="admin-error" id="adminError">Incorrect password. Please try again.</div>
    </div>

    <div id="adminTables" class="admin-tables">
      <div id="adminTableList"></div>
      <button class="admin-save-btn" onclick="saveChanges()">Save All Changes</button>
    </div>
  </div>
</div>

<!-- DOWNLOAD WORD BUTTON -->
<button class="print-word-btn" onclick="downloadWordDoc()">üìÑ Download Word (all tables)</button>
<button class="admin-btn" onclick="openAdmin()">‚öô Admin</button>

<div class="save-toast" id="saveToast">‚ú¶ Changes saved successfully</div>

<script>
// ===== JSON DATABASE with FULL CRUD Operations =====
const TABLE_CATEGORIES = {
  1: 'VVIP', 2: 'VVIP', 4: 'VVIP', 9: 'VVIP CITEC',
  7: 'CITEC / VVIP', 8: 'HOLY CROSS', 10: 'OLQN',
  11: 'HOLY CROSS', 12: 'HOLY CROSS',
  5: 'FAMILY CLUB', 6: 'FAMILY CLUB',
  13: 'VIPs', 14: 'VIPs', 15: 'VIPs',
  16: 'OLQN / OTHERS', 18: 'CELEB FAMILY', 22: 'CELEBS / CHINENYECHE'
};

const DEFAULT_DATA = {
  tables: {
    1: { name: "Table 1", category: "VVIP", guests: ["Mrs. Virgy Anohu","Engr. & Mrs Johnny Chukwu","Mr & Mrs Anastasia Nwobia","Dame (Amb) Nwadibie Anyanwu","Odu Emma Ugwumba and Lolo","His Royalty Otis Anyaeji and Lolo"] },
    2: { name: "Table 2", category: "VVIP", guests: ["Justice Barbara Molokwu","Owelle Sunny Chukwunwendu","Mrs. Ngozi Mbaka","Adaife Ndidi Ezeagwu","Mrs. Comfort Ukpanah","Mrs. Amaka Ebenebe","Mrs Pepetua Ohama","Mrs. Ohomobi"] },
    3: { name: "Table 3", category: "", guests: ["Prof and Mrs. Tunji Olaokpa","Dr Fred Ekwem","Akudo and Lolo Ify Ezie","Dr J.K. Okoye","Dr Mrs Ekweremadu","Dr Bryant Ojiakor and Wife","SAN Asiwaju and Wife"] },
    4: { name: "Table 4", category: "VVIP", guests: ["Fr. Victor Ulam","Fr. Vitalis","Fr. John Oluoma","Fr. Bid Okorie","Fr. Emmanuel","Fr. Jude","Sr. Jovita","Sr. Bridget","Dr and Mrs Ikenga Metu"] },
    5: { name: "Table 5", category: "Family Club", guests: ["Dr and Dr (Mrs) Frank Odafen","Dr and Lolo Dozie Okwuosa","Sir and Lady Joe Wenegieme","Turaki and Turakia Shehu Jafia","Amb. And Mrs James Medugu"] },
    6: { name: "Table 6", category: "Family Club", guests: ["Engr. Peter IgbiniJesu","Chief and Lolo Marcel Ezeagu","Dr Emma Umoh","Mr and Mrs Alfred Abah","Mrs Pauline Otu","Mrs Pamela Mbanefo","Mrs Barbara Dele Oye","Mrs Tonia Igwe","Lady Chidinma Unamma"] },
    7: { name: "Table 7", category: "CITEC / VVIP", guests: ["Gen. (Rtd) Owonibi and Wife","Engr. Olotu and Partner","Ahj. Dawah","AVM (Rtd) Audu Bida","Mr and Mrs Bright Isolo","Mr Chucks Odo","Mr and Mrs Timi Spiff"] },
    8: { name: "Table 8", category: "Holy Cross", guests: ["Chief and Lady Mike Ejiofor","Sir and Lady George Kalu","Chief and Lady Chike Chukwurah","Sir and Lady Denis Ekumankama","Prince and Lolo Obinna Okwuaka"] },
    9: { name: "Table 9", category: "VVIP CITEC", guests: ["Mr and Mrs Uche Duruibe","Mr Akin Fayinminu","Ahj. Abdulahi","Ahj. and Haj. Abubakar","Haj. Are","Sir and Lady Nwabueze Oji","Chief and Mrs Uviovo","Princess Chinelo Onwudiwe","Dr and Mrs Emma Okoye","Arc. and Mrs Nwanah"] },
    10: { name: "Table 10", category: "OLQN", guests: ["Mr and Dr. Mrs Frank Okechukwu","Mr and Mrs Paul Egwuekwe","Mrs Obioma Abangwu","Hon and Mrs Jeff Ojinika","Mrs Florence Enekwe","Chief Mrs Oby Iku","Mrs Nike Omothoso"] },
    11: { name: "Table 11", category: "Holy Cross", guests: ["Chief and Mrs Emeka Eriobuna","High Chief and Lolo Emeka Okonkwo","Chief and Lolo Nwokennaya","Chief Austin Nnamah","Mr and Mrs Achilonu","Mrs Nkiru Achara"] },
    12: { name: "Table 12", category: "Holy Cross", guests: ["Mrs Ebele Okonkwo","Sir and Lady Chika Osuji","Chief and Lolo Umeokeke","Chief and Lolo Frank Aghabalu","Prof and Mrs Nwokocha","AVM Nnamani"] },
    13: { name: "Table 13", category: "VIPs", guests: ["Bar. and Mrs Uche Agu","Chief and Lolo Denis Erilem","Mrs Ijeoma Okoli","Chief and Mrs Nonye Ndidi","Engr and Mrs Obioha","Chief and Lolo U.T. Harris Odinenu"] },
    14: { name: "Table 14", category: "VIPs", guests: ["Mr Chinedu Ogubuike and Wife","Mr Anayo Uzoagba","Mrs Hariette Nwangwu","Mr and Mrs Iyke Chimeh","Mrs Gloria Finbom","Dr and Mrs Agbasi","Mrs Kate Adamu"] },
    15: { name: "Table 15", category: "VIPs", guests: ["Dr and Mrs Cosmas Uwandu","Mrs Ify Uchendu","Mrs Maryanne Ofodile","Capt. (Rtd) and Lolo Frank Ntima","Mrs Nkechi Ebinaso","Mr and Mrs Nkiru Ugwo","Engr and Mrs Paul Okafor"] },
    16: { name: "Table 16", category: "OLQN / Others", guests: ["Dr Mrs Oge Ene","Mrs Nonye Onyechi","Mrs Ngozi Chiefe","Mrs Lily Igwebuike","Mrs Ifeoma Nwogu","Mrs Blessing Ezendu","Mrs Rufina Suleiman","Chief and Lolo Charles Nnodim","Mrs Sopuluchukwu"] },
    17: { name: "Table 17", category: "", guests: ["Mr and Mrs Chinedu Ibe","Mr and Mrs Dorothy Nwanah","Mrs Angelica Kenneth Nkwocha","Mrs Magdalene Sende","Mr Sam Jibo","Mr and Mrs Alfred and Soma Onukaogu","Mr Francis Ojei","Mr and Mrs Chidoziri Nwigwe"] },
    18: { name: "Table 18", category: "Celeb Family", guests: ["Engr Ejike Alakwe Ojimba","Mr and Mrs Ansalem Ezie","Mr and Mrs Somto Ojimba","Mr and Mrs Olisa Ojimba","Engr Walter Ojimba","Engr Izu Ojimba","Mr Chiemezie Ojimba"] },
    19: { name: "Table 19", category: "", guests: ["Mrs Adora Oforah","Mrs Udora Ndukwe","Mr and Mrs Nonso Chilaka","Mrs Uche Nwanekezie","Mr and Mrs Thomas Aneto","Mr and Mrs Eze Ezebuilo","Mrs Amaka Ashiofor"] },
    20: { name: "Table 20", category: "", guests: ["Mrs Susan Oyo","Mrs Ijeoma Oramah","Mrs Winnie Itanyi","Mama Gloria Apugo","Arc and Mrs Stan Nwanna","Engr and Mrs Charles Okeke","Mrs Ogoo Elekwa"] },
    21: { name: "Table 21", category: "", guests: ["Mr Sylvester Egweni","Mr Victor Mowah","Mr and Mrs Emmanuel Akpe","Mr Paul Nombagu","Apaha Yawe","Torkuma Yawe","Ms Keren Odinenu","Mr and Mrs Toritseju Onwubiko","Joy, Diane and Barbara Onwubiko"] },
    22: { name: "Table 22", category: "Chinenyeche's", guests: ["Obinna Ezie and Partner","Osieke Fore","Dumebi Ifedi Myles","Engr Gozie Denwigwe","Barr and Mrs Nnamdi Ekwem","Barr and Mrs Chinedu Ezie","Chiaka Nwoga","Uzoma Eze","Chukwudalu Ezie"] }
  }
};

// LAYOUT
const LAYOUT = [
  [1, 2, 3, 4],
  [5, 6, 7, 8],
  [9, 10, 11, 12],
  [13, 14, 15, 16],
  [17, 18, 19, 20],
  [null, 21, 22, null]
];

// ===== CRUD Database Class =====
class JsonDatabase {
  constructor() {
    this.data = JSON.parse(JSON.stringify(DEFAULT_DATA));
    this.listeners = [];
  }

  // Read
  getData() {
    return JSON.parse(JSON.stringify(this.data)); // Return deep copy
  }

  getTable(tableNum) {
    return this.data.tables[tableNum] ? JSON.parse(JSON.stringify(this.data.tables[tableNum])) : null;
  }

  getAllTables() {
    return JSON.parse(JSON.stringify(this.data.tables));
  }

  // Create (add new table)
  addTable(tableNum, tableData) {
    if (this.data.tables[tableNum]) {
      throw new Error(`Table ${tableNum} already exists`);
    }
    this.data.tables[tableNum] = tableData;
    this._notifyChange();
    return this.getTable(tableNum);
  }

  // Update
  updateTable(tableNum, tableData) {
    if (!this.data.tables[tableNum]) {
      throw new Error(`Table ${tableNum} does not exist`);
    }
    this.data.tables[tableNum] = { ...this.data.tables[tableNum], ...tableData };
    this._notifyChange();
    return this.getTable(tableNum);
  }

  updateGuest(tableNum, guestIndex, guestName) {
    if (!this.data.tables[tableNum]) {
      throw new Error(`Table ${tableNum} does not exist`);
    }
    if (!this.data.tables[tableNum].guests[guestIndex]) {
      throw new Error(`Guest at index ${guestIndex} does not exist`);
    }
    this.data.tables[tableNum].guests[guestIndex] = guestName;
    this._notifyChange();
    return this.getTable(tableNum);
  }

  addGuest(tableNum, guestName) {
    if (!this.data.tables[tableNum]) {
      throw new Error(`Table ${tableNum} does not exist`);
    }
    this.data.tables[tableNum].guests.push(guestName);
    this._notifyChange();
    return this.getTable(tableNum);
  }

  deleteGuest(tableNum, guestIndex) {
    if (!this.data.tables[tableNum]) {
      throw new Error(`Table ${tableNum} does not exist`);
    }
    this.data.tables[tableNum].guests.splice(guestIndex, 1);
    this._notifyChange();
    return this.getTable(tableNum);
  }

  // Delete
  deleteTable(tableNum) {
    if (!this.data.tables[tableNum]) {
      throw new Error(`Table ${tableNum} does not exist`);
    }
    delete this.data.tables[tableNum];
    this._notifyChange();
  }

  // Bulk operations
  importData(newData) {
    this.data = JSON.parse(JSON.stringify(newData));
    this._notifyChange();
  }

  resetToDefault() {
    this.data = JSON.parse(JSON.stringify(DEFAULT_DATA));
    this._notifyChange();
  }

  // Subscribe to changes
  subscribe(listener) {
    this.listeners.push(listener);
    return () => {
      this.listeners = this.listeners.filter(l => l !== listener);
    };
  }

  _notifyChange() {
    this.listeners.forEach(listener => listener(this.getData()));
    this._persistToLocal(); // Auto-save to localStorage as backup
  }

  // Optional: persist to localStorage for refresh persistence
  _persistToLocal() {
    localStorage.setItem('akudo_crud_db', JSON.stringify(this.data));
  }

  loadFromLocal() {
    const saved = localStorage.getItem('akudo_crud_db');
    if (saved) {
      try {
        this.data = JSON.parse(saved);
        this._notifyChange();
      } catch(e) {
        console.error('Failed to load from localStorage');
      }
    }
  }
}

// ===== Initialize Database =====
const db = new JsonDatabase();
db.loadFromLocal(); // Load saved data if exists

// ===== State =====
let adminLoggedIn = false;
let highlightedTable = null;

// ===== Subscribe to database changes =====
db.subscribe((newData) => {
  renderFloor();
  updateStats();
  updateJsonView();
});

// ===== INIT =====
function init() {
  renderFloor();
  updateStats();
  launchConfetti();
  updateJsonView();
}

// ===== RENDER =====
function renderFloor() {
  const data = db.getData();
  const grid = document.getElementById('floorGrid');
  grid.innerHTML = '';

  LAYOUT.forEach((row, rowIdx) => {
    const rowEl = document.createElement('div');
    rowEl.className = 'table-row' + (rowIdx === 5 ? ' last-row' : '');

    row.forEach(tableNum => {
      if (tableNum === null) {
        const spacer = document.createElement('div');
        spacer.className = 'table-spacer';
        rowEl.appendChild(spacer);
        return;
      }

      const t = data.tables[tableNum];
      if (!t) return; // Skip if table doesn't exist
      
      const isVVIP = ['VVIP', 'VVIP CITEC', 'CITEC / VVIP'].includes(t.category);
      const card = document.createElement('div');
      card.className = 'table-card' + (isVVIP ? ' vvip' : '');
      card.id = 'tc-' + tableNum;
      card.onclick = () => openModal(tableNum);
      card.innerHTML = `
        <span class="table-num">${tableNum}</span>
        <span class="table-tag">Table</span>
        <span class="table-count">${t.guests.filter(g=>g.trim()).length} Guest${t.guests.filter(g=>g.trim()).length !== 1 ? 's' : ''}</span>
        ${t.category ? `<span class="table-category">${t.category}</span>` : ''}
      `;
      rowEl.appendChild(card);
    });

    grid.appendChild(rowEl);
  });
}

// ===== MODAL =====
function openModal(tableNum) {
  const data = db.getData();
  const t = data.tables[tableNum];
  if (!t) return;
  
  document.getElementById('modalTitle').textContent = t.name;
  document.getElementById('modalSubtitle').textContent = (t.category ? t.category + ' ‚Äî ' : '') + 'SEATED GUESTS';

  const body = document.getElementById('modalBody');
  body.innerHTML = '';
  const guests = t.guests.filter(g => g.trim());
  if (guests.length === 0) {
    body.innerHTML = '<p style="color:var(--text-muted);font-size:0.8rem;text-align:center;padding:20px">No guests assigned yet.</p>';
  } else {
    guests.forEach((g, i) => {
      const div = document.createElement('div');
      div.className = 'guest-item';
      div.innerHTML = `<span class="guest-num">${i+1}</span><span class="guest-name">${g}</span>`;
      body.appendChild(div);
    });
  }

  document.getElementById('modal').classList.add('open');
  document.getElementById('overlay').classList.add('open');
}

function closeModal() {
  document.getElementById('modal').classList.remove('open');
  document.getElementById('overlay').classList.remove('open');
}

// ===== SEARCH =====
function searchGuest(query) {
  const data = db.getData();
  const resultEl = document.getElementById('searchResult');
  
  if (highlightedTable) {
    document.getElementById('tc-' + highlightedTable)?.classList.remove('highlight');
    highlightedTable = null;
  }

  if (!query || query.trim().length < 2) { 
    resultEl.classList.remove('show'); 
    return; 
  }

  const q = query.toLowerCase();
  let found = [];

  Object.entries(data.tables).forEach(([num, t]) => {
    t.guests.forEach(g => {
      if (g.toLowerCase().includes(q)) {
        found.push({ tableNum: parseInt(num), tableName: t.name, guestName: g });
      }
    });
  });

  if (found.length === 0) {
    resultEl.innerHTML = `<span style="color:var(--text-muted);font-size:0.8rem">No guest found matching "${query}"</span>`;
    resultEl.classList.add('show');
    return;
  }

  resultEl.innerHTML = found.slice(0, 5).map(f =>
    `<div style="margin-bottom:8px;cursor:pointer" onclick="highlightTable(${f.tableNum})">
      <span class="found-name">${f.guestName}</span><br>
      <span class="found-table">üìç ${f.tableName}${data.tables[f.tableNum].category ? ' ‚Äî ' + data.tables[f.tableNum].category : ''}</span>
    </div>`
  ).join('');
  resultEl.classList.add('show');

  highlightTable(found[0].tableNum);
}

function highlightTable(tableNum) {
  if (highlightedTable) {
    document.getElementById('tc-' + highlightedTable)?.classList.remove('highlight');
  }
  highlightedTable = tableNum;
  const el = document.getElementById('tc-' + tableNum);
  if (el) {
    el.classList.add('highlight');
    el.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
}

// ===== STATS =====
function updateStats() {
  const data = db.getData();
  let total = 0;
  Object.values(data.tables).forEach(t => {
    total += t.guests.filter(g => g.trim()).length;
  });
  document.getElementById('statGuests').textContent = total;
}

// ===== ADMIN (updated to use CRUD) =====
function openAdmin() {
  document.getElementById('adminPanel').classList.add('open');
  document.getElementById('adminPwd').value = '';
  document.getElementById('adminError').style.display = 'none';
  if (!adminLoggedIn) {
    document.getElementById('adminLogin').style.display = 'block';
    document.getElementById('adminTables').classList.remove('show');
  }
}

function closeAdmin() {
  document.getElementById('adminPanel').classList.remove('open');
}

function doLogin() {
  const pwd = document.getElementById('adminPwd').value;
  if (pwd === 'joeify&cocic') {
    adminLoggedIn = true;
    document.getElementById('adminLogin').style.display = 'none';
    document.getElementById('adminTables').classList.add('show');
    renderAdminTables();
  } else {
    document.getElementById('adminError').style.display = 'block';
  }
}

function renderAdminTables() {
  const data = db.getData();
  const container = document.getElementById('adminTableList');
  container.innerHTML = '';

  Object.entries(data.tables).forEach(([num, t]) => {
    const card = document.createElement('div');
    card.className = 'admin-table-card';
    card.innerHTML = `
      <div class="admin-table-header" onclick="toggleAdminTable(${num})">
        <h3>${t.name} <span style="color:var(--text-muted);font-size:0.75rem">(${t.guests.filter(g=>g.trim()).length} guests)</span></h3>
        <span class="admin-table-toggle" id="toggle-${num}">‚ñæ</span>
      </div>
      <div class="admin-table-body" id="atb-${num}">
        <div id="guestInputs-${num}">
          ${t.guests.map((g, i) => guestInputRow(num, i, g)).join('')}
        </div>
        <button class="admin-add-btn" onclick="addGuestRow(${num})">+ Add Guest</button>
      </div>
    `;
    container.appendChild(card);
  });
}

function guestInputRow(tableNum, idx, value) {
  return `<div class="admin-guest-row" id="guestRow-${tableNum}-${idx}">
    <span class="admin-guest-num">${idx+1}</span>
    <input class="admin-guest-input" data-table="${tableNum}" data-idx="${idx}" value="${value.replace(/"/g,'&quot;')}" placeholder="Guest name...">
    <button class="admin-delete-btn" onclick="deleteGuestRow(${tableNum},${idx})">‚úï</button>
  </div>`;
}

function toggleAdminTable(num) {
  const body = document.getElementById('atb-' + num);
  const tog = document.getElementById('toggle-' + num);
  body.classList.toggle('open');
  tog.classList.toggle('open');
}

function addGuestRow(tableNum) {
  const container = document.getElementById('guestInputs-' + tableNum);
  const idx = container.children.length;
  container.insertAdjacentHTML('beforeend', guestInputRow(tableNum, idx, ''));
}

function deleteGuestRow(tableNum, idx) {
  const row = document.getElementById(`guestRow-${tableNum}-${idx}`);
  if (row) row.remove();
  const container = document.getElementById('guestInputs-' + tableNum);
  Array.from(container.children).forEach((r, i) => {
    r.id = `guestRow-${tableNum}-${i}`;
    r.querySelector('.admin-guest-num').textContent = i + 1;
    const inp = r.querySelector('.admin-guest-input');
    inp.dataset.idx = i;
  });
}

function saveChanges() {
  // Collect all values from inputs and update database using CRUD
  Object.keys(db.getData().tables).forEach(num => {
    const inputs = document.querySelectorAll(`.admin-guest-input[data-table="${num}"]`);
    const guests = Array.from(inputs).map(i => i.value.trim()).filter(v => v);
    
    // Use CRUD update
    db.updateTable(num, { guests: guests });
  });

  renderAdminTables();
  
  const toast = document.getElementById('saveToast');
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

// ===== JSON DATABASE UI FUNCTIONS =====
function toggleJsonViewer() {
  const viewer = document.getElementById('jsonViewer');
  viewer.classList.toggle('open');
  updateJsonView();
}

function updateJsonView() {
  const data = db.getData();
  document.getElementById('jsonContent').textContent = JSON.stringify(data, null, 2);
}

function copyJson() {
  const data = db.getData();
  navigator.clipboard.writeText(JSON.stringify(data, null, 2));
  const toast = document.getElementById('saveToast');
  toast.textContent = '‚ú¶ JSON copied to clipboard';
  toast.classList.add('show');
  setTimeout(() => {
    toast.classList.remove('show');
    toast.textContent = '‚ú¶ Changes saved successfully';
  }, 3000);
}

function exportJson() {
  const data = db.getData();
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `akudo_seating_${new Date().toISOString().slice(0,10)}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

function importJson() {
  document.getElementById('jsonImportFile').click();
}

function handleJsonImport() {
  const file = document.getElementById('jsonImportFile').files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const imported = JSON.parse(e.target.result);
      // Validate structure (basic check)
      if (imported.tables) {
        db.importData(imported);
        renderAdminTables();
        const toast = document.getElementById('saveToast');
        toast.textContent = '‚ú¶ JSON imported successfully';
        toast.classList.add('show');
        setTimeout(() => {
          toast.classList.remove('show');
          toast.textContent = '‚ú¶ Changes saved successfully';
        }, 3000);
      } else {
        alert('Invalid JSON format: missing tables property');
      }
    } catch(err) {
      alert('Invalid JSON file: ' + err.message);
    }
  };
  reader.readAsText(file);
  document.getElementById('jsonImportFile').value = ''; // Reset
}

function resetToDefault() {
  if (confirm('Reset all data to default? This cannot be undone.')) {
    db.resetToDefault();
    renderAdminTables();
    const toast = document.getElementById('saveToast');
    toast.textContent = '‚ú¶ Reset to default';
    toast.classList.add('show');
    setTimeout(() => {
      toast.classList.remove('show');
      toast.textContent = '‚ú¶ Changes saved successfully';
    }, 3000);
  }
}

// ===== DOWNLOAD WORD =====
function downloadWordDoc() {
  const data = db.getData();
  let content = `AKUDO'S 70TH BIRTHDAY ‚Äì SEATING ARRANGEMENT\n\n`;
  const tableIds = Object.keys(data.tables).sort((a,b)=>a-b);
  tableIds.forEach(num => {
    const t = data.tables[num];
    const cat = t.category ? ` ‚Äì ${t.category}` : '';
    content += `TABLE ${num}${cat.toUpperCase()}\n`;
    t.guests.filter(g => g.trim()).forEach((guest, idx) => {
      content += `${idx+1}.\t${guest}\n`;
    });
    content += `\n`;
  });
  const date = new Date().toLocaleDateString().replace(/\//g,'-');
  const blob = new Blob([content], { type: 'application/msword' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = `akudo_seating_${date}.doc`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(link.href);
}

// ===== CONFETTI =====
function launchConfetti() {
  const canvas = document.getElementById('confetti');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const colors = ['#c9a84c','#e8c97a','#f5e9c8','#fff8e1','#b8860b'];
  const particles = Array.from({length: 80}, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height - canvas.height,
    size: Math.random() * 4 + 2,
    color: colors[Math.floor(Math.random() * colors.length)],
    speed: Math.random() * 1.5 + 0.5,
    drift: Math.random() * 2 - 1,
    rot: Math.random() * Math.PI * 2,
    rotSpeed: (Math.random() - 0.5) * 0.1,
    opacity: Math.random() * 0.6 + 0.2
  }));

  let frame = 0;
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (frame > 300) return;
    particles.forEach(p => {
      ctx.save();
      ctx.globalAlpha = p.opacity;
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = p.color;
      ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
      ctx.restore();
      p.y += p.speed;
      p.x += p.drift;
      p.rot += p.rotSpeed;
      if (p.y > canvas.height) {
        p.y = -10;
        p.x = Math.random() * canvas.width;
      }
    });
    frame++;
    requestAnimationFrame(animate);
  }
  animate();
}

window.onresize = () => {
  const canvas = document.getElementById('confetti');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
};

// Start
init();
</script>
</body>
</html>
